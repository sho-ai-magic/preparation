<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>あさのじゅんびマスター</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            overflow: hidden; /* 全体のスクロールを禁止 */
        }

        .card-container {
            perspective: 1000px;
            width: 100%;
            height: 100%;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            cursor: pointer;
        }

        .card-inner.is-flipped {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 1.25rem;
            border-width: 4px;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }

        .card-back {
            transform: rotateY(180deg);
        }
    </style>
</head>
<body class="bg-blue-50 h-[100dvh] w-screen p-4 lg:p-6">

    <div class="flex flex-col lg:flex-row h-full gap-4 lg:gap-6">
        
        <!-- 時計・カウントダウンエリア -->
        <div class="w-full lg:w-1/3 flex flex-row lg:flex-col gap-4 lg:gap-6 shrink-0 order-1 lg:order-2">
            <!-- デジタル時計 -->
            <div class="flex-1 lg:flex-none bg-gradient-to-br from-yellow-300 to-yellow-400 rounded-[1.5rem] lg:rounded-[2rem] shadow-xl p-4 lg:p-8 flex flex-col items-center justify-center text-white border-b-4 lg:border-b-8 border-yellow-500/30">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="mb-2 opacity-80 hidden lg:block"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                <div id="digital-clock" class="text-4xl lg:text-7xl font-black drop-shadow-lg tracking-tight leading-none">00:00</div>
                <div id="digital-seconds" class="text-lg lg:text-2xl font-bold opacity-90">00</div>
            </div>

            <!-- 出発カウントダウン -->
            <div class="flex-1 lg:flex-1 bg-white rounded-[1.5rem] lg:rounded-[2rem] shadow-xl p-4 lg:p-8 flex flex-col items-center justify-center border-t-8 lg:border-t-[12px] border-orange-400 relative overflow-hidden">
                <div class="text-orange-500 font-black text-sm lg:text-2xl mb-2 lg:mb-4 flex items-center gap-2">
                    <span>しゅっぱつまで</span>
                </div>
                
                <div id="countdown-timer" class="text-xl lg:text-4xl font-black text-gray-700 text-center leading-tight mb-2 lg:mb-6">
                    あと -- 分 -- 秒
                </div>
                
                <div class="w-full border-t border-gray-100 pt-2 lg:pt-6">
                    <label class="block text-center text-[10px] lg:text-xs font-black text-gray-400 uppercase tracking-widest mb-1 lg:mb-2">じかん</label>
                    <input type="time" id="departure-input" value="08:00" onchange="updateDepartureTime()" class="w-full p-2 lg:p-4 bg-gray-50 border-2 border-gray-100 rounded-xl lg:rounded-2xl text-xl lg:text-4xl font-black text-center text-blue-600 focus:border-blue-400 focus:bg-white outline-none transition-all">
                </div>
            </div>
        </div>

        <!-- タスク管理エリア -->
        <div class="flex-1 min-h-0 w-full lg:w-2/3 bg-white rounded-[1.5rem] lg:rounded-[2rem] shadow-xl p-4 lg:p-8 flex flex-col order-2 lg:order-1 border-b-8 border-blue-200">
            <div class="flex justify-between items-center lg:items-end mb-4 lg:mb-6 shrink-0">
                <div>
                    <h1 class="text-2xl lg:text-4xl font-black text-blue-600 lg:mb-2">あさのじゅんび</h1>
                    <div class="flex items-center gap-2 lg:gap-4">
                        <div class="w-32 lg:w-64 h-4 lg:h-6 bg-gray-100 rounded-full overflow-hidden border-2 border-gray-50">
                            <div id="progress-bar" class="h-full bg-green-400 transition-all duration-500 ease-out" style="width: 0%"></div>
                        </div>
                        <span id="progress-text" class="font-bold text-sm lg:text-xl text-gray-500">0 / 0</span>
                    </div>
                </div>
                <button onclick="toggleSettings()" class="p-2 lg:p-3 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                </button>
            </div>

            <!-- タスクグリッド (高さを自動で分配するように設定) -->
            <div id="task-grid" class="flex-1 min-h-0 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-3 gap-3 lg:gap-6 pb-2 overflow-hidden">
                <!-- JavaScriptで生成 -->
            </div>

            <!-- 下部操作エリア -->
            <div class="mt-4 flex flex-col lg:flex-row justify-between items-center gap-2 shrink-0">
                <div id="add-task-form" class="flex gap-2 items-center w-full lg:w-auto">
                    <input type="text" id="new-task-input" placeholder="あたらしいタスク" class="flex-1 lg:w-48 px-4 py-2 border-2 border-gray-200 rounded-xl focus:border-blue-400 outline-none font-bold text-sm lg:text-base">
                    <button onclick="addTask()" class="bg-blue-500 hover:bg-blue-600 text-white p-2 rounded-xl transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    </button>
                </div>
                <button onclick="resetAll()" class="flex items-center gap-2 text-gray-400 hover:text-gray-600 font-bold transition-colors text-xs lg:text-base">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path></svg>
                    はじめからやりなおす
                </button>
            </div>
        </div>

    </div>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full font-bold shadow-2xl transition-all opacity-0 pointer-events-none transform translate-y-4 z-50">
        メッセージ
    </div>

    <script>
        let tasks = [
            { id: 1, text: 'はみがき', completed: false },
            { id: 2, text: 'あさごはん', completed: false },
            { id: 3, text: 'トイレ', completed: false },
            { id: 4, text: 'きがえ', completed: false },
            { id: 5, text: 'くつした', completed: false },
            { id: 6, text: 'ランドセル', completed: false },
            { id: 7, text: 'かみのけ', completed: false }
        ];

        let departureTime = "08:00";
        let isSettingsMode = false;

        window.onload = () => {
            renderTasks();
            startClock();
            document.getElementById('new-task-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addTask();
            });
            window.addEventListener('resize', renderTasks);
        };

        function startClock() {
            setInterval(() => {
                const now = new Date();
                const h = String(now.getHours()).padStart(2, '0');
                const m = String(now.getMinutes()).padStart(2, '0');
                const s = String(now.getSeconds()).padStart(2, '0');
                document.getElementById('digital-clock').textContent = `${h}:${m}`;
                document.getElementById('digital-seconds').textContent = s;
                updateCountdown(now);
            }, 1000);
        }

        function updateCountdown(now) {
            const [depH, depM] = departureTime.split(':').map(Number);
            const target = new Date();
            target.setHours(depH, depM, 0, 0);
            let diff = target - now;
            const timerElement = document.getElementById('countdown-timer');
            if (diff <= 0) {
                timerElement.innerHTML = `<span class="text-red-500 animate-bounce block">しゅっぱつの<br>じかんだよ！</span>`;
            } else {
                const diffMins = Math.floor(diff / 60000);
                const diffSecs = Math.floor((diff % 60000) / 1000);
                timerElement.innerHTML = `あと <span class="text-blue-600 text-2xl lg:text-5xl">${diffMins}</span> 分 <span class="text-lg lg:text-2xl">${diffSecs} 秒</span>`;
            }
        }

        function renderTasks() {
            const grid = document.getElementById('task-grid');
            grid.innerHTML = '';

            // 列数の判定 (Tailwindのブレイクポイントに合わせる)
            const cols = window.innerWidth >= 640 ? 3 : 2;
            const rows = Math.ceil(tasks.length / cols);
            
            // グリッドの高さを自動分配するように設定
            grid.style.gridTemplateRows = `repeat(${rows}, minmax(0, 1fr))`;

            tasks.forEach(task => {
                const card = document.createElement('div');
                card.className = 'card-container';
                
                card.innerHTML = `
                    <div class="card-inner ${task.completed ? 'is-flipped' : ''}" onclick="toggleTask(${task.id})">
                        <div class="card-front bg-white border-blue-200 hover:border-blue-400 text-blue-700">
                            <span class="text-base lg:text-xl xl:text-2xl font-black px-2 text-center">${task.text}</span>
                            ${isSettingsMode ? `
                                <button onclick="event.stopPropagation(); deleteTask(${task.id})" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 shadow-lg hover:bg-red-600 z-10">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                                </button>
                            ` : ''}
                        </div>
                        <div class="card-back bg-green-100 border-green-400 text-green-700">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" class="mb-1 text-green-500"><polyline points="20 6 9 17 4 12"></polyline></svg>
                            <span class="text-xs lg:text-lg font-black">できた！</span>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
            updateProgress();
        }

        function updateProgress() {
            const completed = tasks.filter(t => t.completed).length;
            const total = tasks.length;
            const percent = total > 0 ? (completed / total) * 100 : 0;
            document.getElementById('progress-bar').style.width = `${percent}%`;
            document.getElementById('progress-text').textContent = `${completed} / ${total}`;
        }

        function toggleTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.completed = !task.completed;
                renderTasks();
            }
        }

        function addTask() {
            const input = document.getElementById('new-task-input');
            const text = input.value.trim();
            if (text) {
                tasks.push({ id: Date.now(), text, completed: false });
                input.value = '';
                renderTasks();
                showToast("ついかしたよ！");
            }
        }

        function deleteTask(id) {
            tasks = tasks.filter(t => t.id !== id);
            renderTasks();
            showToast("けしたよ。");
        }

        function resetAll() {
            tasks = tasks.map(t => ({ ...t, completed: false }));
            renderTasks();
            showToast("やりなおそう！");
        }

        function updateDepartureTime() {
            departureTime = document.getElementById('departure-input').value;
            showToast(`しゅっぱつは ${departureTime}`);
        }

        function toggleSettings() {
            isSettingsMode = !isSettingsMode;
            renderTasks();
            showToast(isSettingsMode ? "へんしゅうモード" : "じゅんびモード");
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.remove('opacity-0', 'translate-y-4', 'pointer-events-none');
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-4', 'pointer-events-none');
            }, 2000);
        }
    </script>
</body>
</html>
